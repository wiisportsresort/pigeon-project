import"./Post.svelte.css.proxy.js";import{SvelteComponent as me,add_render_callback as ue,append as g,attr as j,check_outros as N,create_component as S,create_in_transition as ae,destroy_component as T,destroy_each as U,detach as $,element as y,empty as D,group_outros as z,init as pe,insert as w,listen as V,mount_component as I,noop as _e,safe_not_equal as W,set_data as X,space as L,text as E,transition_in as p,transition_out as d}from"../../_snowpack/pkg/svelte/internal.js";import{pop as Y}from"../../_snowpack/pkg/svelte-spa-router.js";import{fade as de}from"../../_snowpack/pkg/svelte/transition.js";import Z from"../components/IconButton.svelte.js";import x from"../components/LargePostCard.svelte.js";import F from"../components/PostCard.svelte.js";import{assert as G}from"../util.js";function ee(c,e,f){const n=c.slice();return n[7]=e[f],n}function te(c,e,f){const n=c.slice();return n[10]=e[f],n}function ke(c){let e,f,n,i,l,t,u,o,s=c[0].id+"",r,a,h,C;return i=new Z({props:{icon:"arrow-left",size:32,iconSize:20}}),{c(){e=y("header"),f=y("div"),n=y("div"),S(i.$$.fragment),l=L(),t=y("span"),u=E("Post not found: "),o=y("code"),r=E(s),j(f,"id","back-button-wrapper"),j(f,"class","svelte-3y7qmr"),j(t,"class","heading svelte-3y7qmr"),j(e,"class","svelte-3y7qmr")},m(b,q){w(b,e,q),g(e,f),g(f,n),I(i,n,null),g(e,l),g(e,t),g(t,u),g(t,o),g(o,r),a=!0,h||(C=V(n,"click",Y),h=!0)},p(b,q){(!a||q&1)&&s!==(s=b[0].id+"")&&X(r,s)},i(b){a||(p(i.$$.fragment,b),a=!0)},o(b){d(i.$$.fragment,b),a=!1},d(b){b&&$(e),T(i),h=!1,C()}}}function ve(c){var K,M;let e,f,n,i,l,t,u,o,s,r=((K=c[1].author)==null?void 0:K.username)+"",a,h,C,b,q,A,H,J;i=new Z({props:{icon:"arrow-left",size:32,iconSize:20}});let B=G(c[2]),_=[];for(let m=0;m<B.length;m+=1)_[m]=ne(te(c,B,m));const ce=m=>d(_[m],1,1,()=>{_[m]=null});let v=((M=c[1].comments)==null?void 0:M.length)&&le(c);return{c(){e=y("header"),f=y("div"),n=y("div"),S(i.$$.fragment),l=L(),t=y("span"),u=E("Post by "),o=y("b"),s=E("@"),a=E(r),h=L(),C=y("section");for(let m=0;m<_.length;m+=1)_[m].c();b=L(),v&&v.c(),q=D(),j(f,"id","back-button-wrapper"),j(f,"class","svelte-3y7qmr"),j(e,"class","svelte-3y7qmr"),j(C,"id","posts")},m(m,k){w(m,e,k),g(e,f),g(f,n),I(i,n,null),g(e,l),g(e,t),g(t,u),g(t,o),g(o,s),g(o,a),w(m,h,k),w(m,C,k);for(let O=0;O<_.length;O+=1)_[O].m(C,null);w(m,b,k),v&&v.m(m,k),w(m,q,k),A=!0,H||(J=V(n,"click",Y),H=!0)},p(m,k){var O,Q;if((!A||k&2)&&r!==(r=((O=m[1].author)==null?void 0:O.username)+"")&&X(a,r),k&28){B=G(m[2]);let P;for(P=0;P<B.length;P+=1){const R=te(m,B,P);_[P]?(_[P].p(R,k),p(_[P],1)):(_[P]=ne(R),_[P].c(),p(_[P],1),_[P].m(C,null))}for(z(),P=B.length;P<_.length;P+=1)ce(P);N()}((Q=m[1].comments)==null?void 0:Q.length)?v?(v.p(m,k),k&2&&p(v,1)):(v=le(m),v.c(),p(v,1),v.m(q.parentNode,q)):v&&(z(),d(v,1,1,()=>{v=null}),N())},i(m){if(!A){p(i.$$.fragment,m);for(let k=0;k<B.length;k+=1)p(_[k]);p(v),A=!0}},o(m){d(i.$$.fragment,m),_=_.filter(Boolean);for(let k=0;k<_.length;k+=1)d(_[k]);d(v),A=!1},d(m){m&&$(e),T(i),m&&$(h),m&&$(C),U(_,m),m&&$(b),v&&v.d(m),m&&$(q),H=!1,J()}}}function ne(c){let e,f,n;var i=c[4](c[10])?x:F;function l(t){return{props:{post:t[10],showParent:t[4](t[10]),interactive:t[4](t[10])?"header":"full",type:t[3](t[10])}}}return i&&(e=new i(l(c))),{c(){e&&S(e.$$.fragment),f=D()},m(t,u){e&&I(e,t,u),w(t,f,u),n=!0},p(t,u){const o={};if(u&4&&(o.post=t[10]),u&4&&(o.showParent=t[4](t[10])),u&4&&(o.interactive=t[4](t[10])?"header":"full"),u&4&&(o.type=t[3](t[10])),i!==(i=t[4](t[10])?x:F)){if(e){z();const s=e;d(s.$$.fragment,1,0,()=>{T(s,1)}),N()}i?(e=new i(l(t)),S(e.$$.fragment),p(e.$$.fragment,1),I(e,f.parentNode,f)):e=null}else i&&e.$set(o)},i(t){n||(e&&p(e.$$.fragment,t),n=!0)},o(t){e&&d(e.$$.fragment,t),n=!1},d(t){t&&$(f),e&&T(e,t)}}}function le(c){let e,f,n,i,l=[...c[1].comments].sort(fe),t=[];for(let o=0;o<l.length;o+=1)t[o]=ie(ee(c,l,o));const u=o=>d(t[o],1,1,()=>{t[o]=null});return{c(){e=y("h3"),e.textContent="Comments",f=L(),n=y("section");for(let o=0;o<t.length;o+=1)t[o].c();j(n,"id","comments")},m(o,s){w(o,e,s),w(o,f,s),w(o,n,s);for(let r=0;r<t.length;r+=1)t[r].m(n,null);i=!0},p(o,s){if(s&2){l=[...o[1].comments].sort(fe);let r;for(r=0;r<l.length;r+=1){const a=ee(o,l,r);t[r]?(t[r].p(a,s),p(t[r],1)):(t[r]=ie(a),t[r].c(),p(t[r],1),t[r].m(n,null))}for(z(),r=l.length;r<t.length;r+=1)u(r);N()}},i(o){if(!i){for(let s=0;s<l.length;s+=1)p(t[s]);i=!0}},o(o){t=t.filter(Boolean);for(let s=0;s<t.length;s+=1)d(t[s]);i=!1},d(o){o&&$(e),o&&$(f),o&&$(n),U(t,o)}}}function oe(c){var t,u,o;let e,f,n,i;e=new F({props:{post:c[7].comments[0],showParent:!1,interactive:"full",type:((u=(t=c[7].comments[0])==null?void 0:t.comments)==null?void 0:u.length)?"linked-full":"linked-top"}});let l=((o=c[7].comments[0].comments)==null?void 0:o.length)&&re(c);return{c(){S(e.$$.fragment),f=L(),l&&l.c(),n=D()},m(s,r){I(e,s,r),w(s,f,r),l&&l.m(s,r),w(s,n,r),i=!0},p(s,r){var h,C,b;const a={};r&2&&(a.post=s[7].comments[0]),r&2&&(a.type=((C=(h=s[7].comments[0])==null?void 0:h.comments)==null?void 0:C.length)?"linked-full":"linked-top"),e.$set(a),((b=s[7].comments[0].comments)==null?void 0:b.length)?l?(l.p(s,r),r&2&&p(l,1)):(l=re(s),l.c(),p(l,1),l.m(n.parentNode,n)):l&&(z(),d(l,1,1,()=>{l=null}),N())},i(s){i||(p(e.$$.fragment,s),p(l),i=!0)},o(s){d(e.$$.fragment,s),d(l),i=!1},d(s){T(e,s),s&&$(f),l&&l.d(s),s&&$(n)}}}function re(c){let e,f;return e=new F({props:{post:c[7].comments[0].comments[0],showParent:!1,interactive:"full",type:"linked-top"}}),{c(){S(e.$$.fragment)},m(n,i){I(e,n,i),f=!0},p(n,i){const l={};i&2&&(l.post=n[7].comments[0].comments[0]),e.$set(l)},i(n){f||(p(e.$$.fragment,n),f=!0)},o(n){d(e.$$.fragment,n),f=!1},d(n){T(e,n)}}}function ie(c){var t,u;let e,f,n,i;e=new F({props:{post:c[7],showParent:!0,interactive:"full",type:((t=c[7].comments)==null?void 0:t.length)?"linked-bottom":void 0}});let l=((u=c[7].comments)==null?void 0:u.length)&&oe(c);return{c(){S(e.$$.fragment),f=L(),l&&l.c(),n=D()},m(o,s){I(e,o,s),w(o,f,s),l&&l.m(o,s),w(o,n,s),i=!0},p(o,s){var a,h;const r={};s&2&&(r.post=o[7]),s&2&&(r.type=((a=o[7].comments)==null?void 0:a.length)?"linked-bottom":void 0),e.$set(r),((h=o[7].comments)==null?void 0:h.length)?l?(l.p(o,s),s&2&&p(l,1)):(l=oe(o),l.c(),p(l,1),l.m(n.parentNode,n)):l&&(z(),d(l,1,1,()=>{l=null}),N())},i(o){i||(p(e.$$.fragment,o),p(l),i=!0)},o(o){d(e.$$.fragment,o),d(l),i=!1},d(o){T(e,o),o&&$(f),l&&l.d(o),o&&$(n)}}}function se(c){let e,f,n,i,l,t;const u=[ve,ke],o=[];function s(r,a){return r[1]?0:1}return n=s(c,-1),i=o[n]=u[n](c),{c(){e=y("div"),f=y("div"),i.c(),j(f,"id","post"),j(f,"class","svelte-3y7qmr")},m(r,a){w(r,e,a),g(e,f),o[n].m(f,null),t=!0},p(r,a){let h=n;n=s(r,a),n===h?o[n].p(r,a):(z(),d(o[h],1,1,()=>{o[h]=null}),N(),i=o[n],i?i.p(r,a):(i=o[n]=u[n](r),i.c()),p(i,1),i.m(f,null))},i(r){t||(p(i),l||ue(()=>{l=ae(e,de,{duration:100}),l.start()}),t=!0)},o(r){d(i),t=!1},d(r){r&&$(e),o[n].d()}}}function he(c){let e=c[1],f,n,i=se(c);return{c(){i.c(),f=D()},m(l,t){i.m(l,t),w(l,f,t),n=!0},p(l,[t]){t&2&&W(e,e=l[1])?(z(),d(i,1,1,_e),N(),i=se(l),i.c(),p(i),i.m(f.parentNode,f)):i.p(l,t)},i(l){n||(p(i),n=!0)},o(l){d(i),n=!1},d(l){l&&$(f),i.d(l)}}}const fe=({timestamp:c},{timestamp:e})=>e.getTime()-c.getTime();function be(c,e,f){let n,{hydrator:i}=e,{params:l={id:void 0}}=e,t=i.getPost(l.id);const u=(...r)=>r[0].parent?u(r[0].parent,...r):r,o=r=>{if((n==null?void 0:n.length)!==1)return(n==null?void 0:n.indexOf(r))===0?"linked-bottom":(n==null?void 0:n.indexOf(r))!==G(n==null?void 0:n.length)-1?"linked-full":"linked-top"},s=r=>r.id===G(t).id;return c.$$set=r=>{"hydrator"in r&&f(5,i=r.hydrator),"params"in r&&f(0,l=r.params)},c.$$.update=()=>{if(c.$$.dirty&33){e:f(1,t=i.getPost(l.id))}if(c.$$.dirty&2){e:f(2,n=t?u(t):void 0)}},[l,t,n,o,s,i]}class ge extends me{constructor(e){super();pe(this,e,be,he,W,{hydrator:5,params:0})}}export default ge;
